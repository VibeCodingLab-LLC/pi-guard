# =============================================================================
# Pi Guard - Snort Suppression & Threshold Rules
# /etc/snort/threshold.conf
#
# Purpose: Reduce false positives from normal home network traffic
#
# To find noisy rules, run:
#   grep "Priority:" /var/log/snort/alert | cut -d'[' -f2 | cut -d']' -f1 | \
#   sort | uniq -c | sort -nr | head -10
#
# Syntax:
#   suppress gen_id <gid>, sig_id <sid>
#   suppress gen_id <gid>, sig_id <sid>, track by_src, ip <ip>
#   threshold gen_id <gid>, sig_id <sid>, type <limit|threshold|both>, \
#             track <by_src|by_dst>, count <n>, seconds <s>
# =============================================================================

# =============================================================================
# COMMON FALSE POSITIVES (Home Networks)
# =============================================================================

# UPnP/SSDP Discovery (Chromecasts, Smart TVs, etc.)
# These are normal for home networks
suppress gen_id 1, sig_id 1917    # SSDP M-SEARCH
suppress gen_id 1, sig_id 1918    # SSDP NOTIFY

# ICMP (normal pings)
suppress gen_id 1, sig_id 384     # ICMP destination unreachable
suppress gen_id 1, sig_id 385     # ICMP redirect
suppress gen_id 1, sig_id 402     # ICMP echo reply

# DNS (normal queries - Pi-hole handles these)
suppress gen_id 1, sig_id 254     # DNS version request
suppress gen_id 1, sig_id 1616    # DNS zone transfer

# SMB/NetBIOS (Windows file sharing)
suppress gen_id 1, sig_id 2103    # SMB negotiate
suppress gen_id 1, sig_id 2465    # NetBIOS name query

# mDNS/Bonjour (Apple devices, Chromecasts)
suppress gen_id 1, sig_id 23756   # mDNS query

# =============================================================================
# THRESHOLD RULES (Rate limiting alerts)
# =============================================================================

# Limit SSH alerts to 5 per minute per source
event_filter gen_id 1, sig_id 0, type limit, track by_src, count 5, seconds 60

# Limit port scan alerts
event_filter gen_id 122, sig_id 0, type limit, track by_src, count 3, seconds 60

# =============================================================================
# SUPPRESS BY SOURCE IP (Your known devices)
# =============================================================================

# Suppress alerts from your router (replace with your router IP)
# suppress gen_id 1, sig_id 0, track by_src, ip 192.168.1.1

# Suppress alerts from trusted internal servers
# suppress gen_id 1, sig_id 0, track by_src, ip 192.168.1.100

# =============================================================================
# ADD YOUR CUSTOM SUPPRESSIONS BELOW
# =============================================================================
# After running Pi Guard for a few days, check your top alerts:
#
#   grep "Priority:" /var/log/snort/alert | cut -d'[' -f2 | cut -d']' -f1 | \
#   sort | uniq -c | sort -nr | head -10
#
# Then add suppression rules for false positives, e.g.:
#   suppress gen_id 1, sig_id 12345
#
# Documentation: https://docs.snort.org/start/rules
# =============================================================================
